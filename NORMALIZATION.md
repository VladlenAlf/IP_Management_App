# Нормализация сетевых адресов

## Описание проблемы
При добавлении новой подсети или объединении существующих подсетей пользователь мог указать любой IP-адрес внутри подсети (например, 10.0.11.0/23), а не фактический сетевой адрес (в этом случае — 10.0.10.0/23). Это приводило к:
- Ошибкам в расчетах
- Дублированию подсетей
- Неправильной обработке перекрытий
- Некорректному отображению в интерфейсе

## Решение
Реализована автоматическая нормализация адреса при добавлении и редактировании подсетей. IP-адрес автоматически преобразуется к правильному сетевому адресу (network address), соответствующему указанной маске.

## Реализованные функции

### Frontend (app.js)
- `normalizeToNetworkAddress(ip, cidr)` - основная функция нормализации
- `isValidIP(ip)` - валидация формата IP-адреса
- `ipToInt(ip)` и `intToIp(int)` - конвертация между IP и числовым представлением
- Обработчики событий для формы добавления/редактирования подсети
- Визуальные подсказки в реальном времени (показ правильного сетевого адреса)

### Backend (server.js)
- Дублирование функций нормализации для серверной валидации
- Обновленные API endpoints для создания и редактирования подсетей
- Нормализация при импорте из Excel
- Логирование операций нормализации в audit logs

## Где применяется нормализация

### 1. Создание новой подсети (`POST /api/subnets`)
- Валидация формата IP и маски
- Автоматическая нормализация адреса
- Уведомление пользователя об изменениях
- Сохранение нормализованного адреса в БД

### 2. Редактирование подсети (`PUT /api/subnets/:id`)
- Такая же логика как при создании
- Обновление существующей записи с нормализованным адресом

### 3. Импорт из Excel (`POST /api/import-excel`)
- Нормализация всех импортируемых адресов
- Валидация перед записью в БД
- Отчет об ошибках валидации

### 4. Визуальная обратная связь (Frontend)
- Подсказки в реальном времени при вводе
- Показ правильного сетевого адреса под полем ввода
- Автоматическое обновление при изменении маски

## Примеры нормализации

| Введенный IP | Маска | Нормализованный IP | Описание |
|--------------|-------|-------------------|----------|
| 192.168.1.100 | /24 | 192.168.1.0 | Обычная локальная сеть |
| 10.0.11.50 | /23 | 10.0.10.0 | Проблемный случай из задачи |
| 172.16.5.100 | /20 | 172.16.0.0 | Корпоративная сеть |
| 192.168.1.200 | /25 | 192.168.1.128 | Подсеть /25 |
| 10.1.1.1 | /30 | 10.1.1.0 | Point-to-point |

## Валидация
- **IP-адреса**: Проверка формата (0-255 для каждого октета)
- **Маски**: Проверка диапазона (0-32)
- **Типы данных**: Проверка на число для маски
- **Граничные случаи**: Обработка некорректных входных данных

## Пользовательский интерфейс

### Подсказки в реальном времени
При вводе IP-адреса и выборе маски система показывает:
```
Adres sieciowy: 10.0.10.0/23
```

### Уведомления
При сохранении подсети с нормализованным адресом:
```
Adres IP został znormalizowany z 10.0.11.0 na 10.0.10.0/23
```

### Стили CSS
- `.normalization-hint` - стили для подсказок
- Цветовое выделение правильного адреса
- Responsive дизайн для мобильных устройств

## Преимущества реализации

1. **Предотвращение ошибок**: Невозможно создать подсеть с неправильным адресом
2. **Улучшенный UX**: Визуальная обратная связь в реальном времени
3. **Целостность данных**: Все адреса в БД корректны и соответствуют маскам
4. **Совместимость**: Работает как с новыми, так и с импортированными данными
5. **Логирование**: Все операции нормализации записываются в audit logs

## Безопасность
- Двойная валидация (frontend + backend)
- Защита от SQL-инъекций
- Корректная обработка некорректных данных
- Логирование всех операций для аудита

## Тестирование
Реализованы автоматические тесты для:
- Основных сценариев нормализации
- Граничных случаев
- Некорректных входных данных
- Различных масок подсетей

Все тесты проходят успешно, что гарантирует корректность работы алгоритма нормализации.
