<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Management System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-left">
                    <h1>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è IP –∞–¥—Ä–µ—Å–∞–º–∏</h1>
                </div>
                <div class="header-right">
                    <span class="user-info" id="userInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    <button class="btn btn-secondary btn-small" onclick="logout()">–í—ã–π—Ç–∏</button>
                </div>
            </div>
            <div class="stats" id="stats">
                <div class="stat-item">
                    <span class="stat-number" id="totalIps">0</span>
                    <span class="stat-label">–í—Å–µ–≥–æ IP</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number occupied" id="occupiedIps">0</span>
                    <span class="stat-label">–ó–∞–Ω—è—Ç–æ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number free" id="freeIps">0</span>
                    <span class="stat-label">–°–≤–æ–±–æ–¥–Ω–æ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalSubnets">0</span>
                    <span class="stat-label">–ü–æ–¥—Å–µ—Ç–µ–π</span>
                </div>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-button active" onclick="showTab('ip-management')">IP –ê–¥—Ä–µ—Å–∞</button>
            <button class="tab-button" onclick="showTab('subnet-management')">–ü–æ–¥—Å–µ—Ç–∏</button>
            <button class="tab-button" onclick="showTab('import-export')">–ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç</button>
            <button class="tab-button" onclick="showTab('analytics')">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
            <button class="tab-button" onclick="showTab('audit-logs')">–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</button>
        </nav>

        <!-- IP Management Tab -->
        <div id="ip-management" class="tab-content active">
            <div class="toolbar">
                <button class="btn btn-primary" onclick="showAddIpModal()">–î–æ–±–∞–≤–∏—Ç—å IP</button>
                <button class="btn btn-success" onclick="showBulkIpModal()">–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ IP</button>
                
                <div class="filters">
                    <select id="subnetFilter" onchange="filterIPs()">
                        <option value="">–í—Å–µ –ø–æ–¥—Å–µ—Ç–∏</option>
                    </select>
                    
                    <select id="statusFilter" onchange="filterIPs()">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="1">–ó–∞–Ω—è—Ç–æ</option>
                        <option value="0">–°–≤–æ–±–æ–¥–Ω–æ</option>
                    </select>
                    
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫..." onkeyup="filterIPs()">
                </div>
            </div>

            <div class="table-container">
                <table id="ipTable">
                    <thead>
                        <tr>
                            <th>IP –ê–¥—Ä–µ—Å</th>
                            <th>–ü–æ–¥—Å–µ—Ç—å</th>
                            <th>–ö–æ–º–ø–∞–Ω–∏—è</th>
                            <th>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Subnet Management Tab -->
        <div id="subnet-management" class="tab-content">
            <div class="toolbar">
                <button class="btn btn-primary" onclick="showAddSubnetModal()">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–µ—Ç—å</button>
            </div>

            <div class="table-container">
                <table id="subnetTable">
                    <thead>
                        <tr>
                            <th>–°–µ—Ç—å</th>
                            <th>–ú–∞—Å–∫–∞</th>
                            <th>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–¥—Ä–µ—Å–∞</th>
                            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                            <th>–°–æ–∑–¥–∞–Ω–æ</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- Import/Export Tab -->
        <div id="import-export" class="tab-content">
            <div class="import-section">
                <h3>–ò–º–ø–æ—Ä—Ç –∏–∑ Excel</h3>
                <div class="file-upload">
                    <input type="file" id="excelFile" accept=".xlsx,.xls" onchange="handleFileSelect()">
                    <button class="btn btn-primary" onclick="importExcel()">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div class="import-info">
                    <p>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏: ip_address, company_name, assigned_date, is_occupied, description</p>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="toolbar">
                <div class="analytics-filters">
                    <select id="analyticsSubnetFilter" onchange="updateAnalytics()">
                        <option value="">–í—Å–µ –ø–æ–¥—Å–µ—Ç–∏</option>
                    </select>
                    
                    <input type="date" id="analyticsDateFrom" onchange="updateAnalytics()">
                    <span>–¥–æ</span>
                    <input type="date" id="analyticsDateTo" onchange="updateAnalytics()">
                    
                    <button class="btn btn-secondary" onclick="resetAnalyticsFilters()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                    <button class="btn btn-primary" onclick="updateAnalytics()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>

            <div class="analytics-grid">
                <!-- Main Stats Cards -->
                <div class="analytics-card">
                    <h3>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stats-mini">
                        <div class="stat-mini">
                            <span class="stat-value" id="analyticsTotal">0</span>
                            <span class="stat-label">–í—Å–µ–≥–æ IP</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-value occupied" id="analyticsOccupied">0</span>
                            <span class="stat-label">–ó–∞–Ω—è—Ç–æ</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-value free" id="analyticsFree">0</span>
                            <span class="stat-label">–°–≤–æ–±–æ–¥–Ω–æ</span>
                        </div>
                        <div class="stat-mini">
                            <span class="stat-value" id="analyticsSubnets">0</span>
                            <span class="stat-label">–ü–æ–¥—Å–µ—Ç–µ–π</span>
                        </div>
                    </div>
                </div>

                <!-- IP Usage Pie Chart -->
                <div class="analytics-card">
                    <h3>ü•ß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ IP –∞–¥—Ä–µ—Å–æ–≤</h3>
                    <canvas id="ipUsageChart"></canvas>
                </div>

                <!-- Subnets Bar Chart -->
                <div class="analytics-card">
                    <h3>üìà IP –∞–¥—Ä–µ—Å–∞ –ø–æ –ø–æ–¥—Å–µ—Ç—è–º</h3>
                    <canvas id="subnetsChart"></canvas>
                </div>

                <!-- Companies Bar Chart -->
                <div class="analytics-card">
                    <h3>üè¢ –¢–æ–ø –∫–æ–º–ø–∞–Ω–∏–π –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é IP</h3>
                    <canvas id="companiesChart"></canvas>
                </div>

                <!-- Monthly Activity Line Chart -->
                <div class="analytics-card chart-wide">
                    <h3>üìÖ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º (–≤—ã–¥–∞—á–∞ IP –∞–¥—Ä–µ—Å–æ–≤)</h3>
                    <canvas id="monthlyChart"></canvas>
                </div>

                <!-- Subnet Utilization -->
                <div class="analytics-card chart-wide">
                    <h3>üìä –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥—Å–µ—Ç–µ–π (%)</h3>
                    <canvas id="utilizationChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Audit Logs Tab -->
        <div id="audit-logs" class="tab-content">
            <div class="toolbar">
                <div class="filters">
                    <select id="actionFilter" onchange="filterLogs()">
                        <option value="">–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è</option>
                        <option value="LOGIN">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</option>
                        <option value="LOGOUT">–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã</option>
                        <option value="CREATE">–°–æ–∑–¥–∞–Ω–∏–µ</option>
                        <option value="UPDATE">–ò–∑–º–µ–Ω–µ–Ω–∏–µ</option>
                        <option value="DELETE">–£–¥–∞–ª–µ–Ω–∏–µ</option>
                        <option value="IMPORT">–ò–º–ø–æ—Ä—Ç</option>
                        <option value="BULK">–ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</option>
                    </select>
                    
                    <select id="entityFilter" onchange="filterLogs()">
                        <option value="">–í—Å–µ –æ–±—ä–µ–∫—Ç—ã</option>
                        <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
                        <option value="subnet">–ü–æ–¥—Å–µ—Ç–∏</option>
                        <option value="ip_address">IP –∞–¥—Ä–µ—Å–∞</option>
                    </select>
                    
                    <input type="text" id="userFilter" placeholder="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å..." onkeyup="filterLogs()">
                    
                    <button class="btn btn-secondary" onclick="refreshLogs()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>

            <div class="table-container">
                <table id="logsTable">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞/–í—Ä–µ–º—è</th>
                            <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                            <th>–û–±—ä–µ–∫—Ç</th>
                            <th>ID</th>
                            <th>–î–µ—Ç–∞–ª–∏</th>
                            <th>IP –∞–¥—Ä–µ—Å</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <div class="pagination" id="logsPagination"></div>
        </div>

    </div>

    <!-- Modal for adding/editing IP -->
    <div id="ipModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('ipModal')">&times;</span>
            <h2 id="ipModalTitle">–î–æ–±–∞–≤–∏—Ç—å IP –∞–¥—Ä–µ—Å</h2>
            <form id="ipForm">
                <input type="hidden" id="ipId">
                
                <div class="form-group">
                    <label for="ipAddress">IP –ê–¥—Ä–µ—Å:</label>
                    <input type="text" id="ipAddress" required>
                </div>
                
                <div class="form-group">
                    <label for="ipSubnet">–ü–æ–¥—Å–µ—Ç—å:</label>
                    <select id="ipSubnet">
                        <option value="">–ë–µ–∑ –ø–æ–¥—Å–µ—Ç–∏</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="companyName">–ö–æ–º–ø–∞–Ω–∏—è:</label>
                    <input type="text" id="companyName">
                </div>
                
                <div class="form-group">
                    <label for="assignedDate">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:</label>
                    <input type="date" id="assignedDate">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="isOccupied"> –ó–∞–Ω—è—Ç
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="ipDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="ipDescription" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('ipModal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for adding subnet -->
    <div id="subnetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('subnetModal')">&times;</span>
            <h2 id="subnetModalTitle">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Å–µ—Ç—å</h2>
            <form id="subnetForm">
                <input type="hidden" id="subnetId">
                
                <div class="form-group">
                    <label for="subnetNetwork">–°–µ—Ç—å:</label>
                    <input type="text" id="subnetNetwork" placeholder="192.168.1.0" required>
                </div>
                
                <div class="form-group">
                    <label for="subnetMask">–ú–∞—Å–∫–∞:</label>
                    <select id="subnetMask" required>
                        <option value="24">/24 (255.255.255.0) - 254 –∞–¥—Ä–µ—Å–∞</option>
                        <option value="25">/25 (255.255.255.128) - 126 –∞–¥—Ä–µ—Å–æ–≤</option>
                        <option value="26">/26 (255.255.255.192) - 62 –∞–¥—Ä–µ—Å–∞</option>
                        <option value="27">/27 (255.255.255.224) - 30 –∞–¥—Ä–µ—Å–æ–≤</option>
                        <option value="28">/28 (255.255.255.240) - 14 –∞–¥—Ä–µ—Å–æ–≤</option>
                        <option value="29">/29 (255.255.255.248) - 6 –∞–¥—Ä–µ—Å–æ–≤</option>
                        <option value="30">/30 (255.255.255.252) - 2 –∞–¥—Ä–µ—Å–∞</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="subnetDescription">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="subnetDescription" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('subnetModal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for bulk IP creation -->
    <div id="bulkIpModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('bulkIpModal')">&times;</span>
            <h2>–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–æ–≤</h2>
            <form id="bulkIpForm">
                <div class="form-group">
                    <label for="bulkSubnet">–ü–æ–¥—Å–µ—Ç—å:</label>
                    <select id="bulkSubnet" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Å–µ—Ç—å</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="startIp">–ù–∞—á–∞–ª—å–Ω—ã–π IP –∞–¥—Ä–µ—Å:</label>
                    <input type="text" id="startIp" placeholder="192.168.1.10" required>
                </div>
                
                <div class="form-group">
                    <label for="endIp">–ö–æ–Ω–µ—á–Ω—ã–π IP –∞–¥—Ä–µ—Å:</label>
                    <input type="text" id="endIp" placeholder="192.168.1.20" required>
                </div>
                
                <div class="form-group">
                    <label for="bulkCompanyName">–ö–æ–º–ø–∞–Ω–∏—è (–¥–ª—è –≤—Å–µ—Ö IP):</label>
                    <input type="text" id="bulkCompanyName">
                </div>
                
                <div class="form-group">
                    <label for="bulkAssignedDate">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ (–¥–ª—è –≤—Å–µ—Ö IP):</label>
                    <input type="date" id="bulkAssignedDate">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="bulkIsOccupied"> –í—Å–µ IP –∑–∞–Ω—è—Ç—ã
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="bulkDescription">–û–ø–∏—Å–∞–Ω–∏–µ (–¥–ª—è –≤—Å–µ—Ö IP):</label>
                    <textarea id="bulkDescription" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å IP –∞–¥—Ä–µ—Å–∞</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('bulkIpModal')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for log details -->
    <div id="logDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('logDetailsModal')">&times;</span>
            <h2>–î–µ—Ç–∞–ª–∏ –ª–æ–≥–∞ –∞—É–¥–∏—Ç–∞</h2>
            <div id="logDetailsContent">
                <div class="log-detail-section">
                    <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <div class="log-detail-grid">
                        <div class="log-detail-item">
                            <strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong>
                            <span id="logDetailDate"></span>
                        </div>
                        <div class="log-detail-item">
                            <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong>
                            <span id="logDetailUser"></span>
                        </div>
                        <div class="log-detail-item">
                            <strong>–î–µ–π—Å—Ç–≤–∏–µ:</strong>
                            <span id="logDetailAction"></span>
                        </div>
                        <div class="log-detail-item">
                            <strong>–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞:</strong>
                            <span id="logDetailEntity"></span>
                        </div>
                        <div class="log-detail-item">
                            <strong>ID –æ–±—ä–µ–∫—Ç–∞:</strong>
                            <span id="logDetailEntityId"></span>
                        </div>
                        <div class="log-detail-item">
                            <strong>IP –∞–¥—Ä–µ—Å:</strong>
                            <span id="logDetailIp"></span>
                        </div>
                    </div>
                </div>
                
                <div class="log-detail-section" id="oldValuesSection" style="display: none;">
                    <h3>–°—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</h3>
                    <pre id="logDetailOldValues" class="log-values"></pre>
                </div>
                
                <div class="log-detail-section" id="newValuesSection" style="display: none;">
                    <h3>–ù–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</h3>
                    <pre id="logDetailNewValues" class="log-values"></pre>
                </div>
                
                <div class="log-detail-section">
                    <h3>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <div class="log-detail-item">
                        <strong>User Agent:</strong>
                        <span id="logDetailUserAgent" style="word-break: break-all;"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js"></script>
</body>
</html>